!function($){"use strict";var t={init:function(a){return this.each(function(){this.self=$(this),t.destroy.call(this.self),this.opt=$.extend(!0,{},$.fn.raty.defaults,a),t._adjustCallback.call(this),t._adjustNumber.call(this),t._adjustHints.call(this),this.opt.score=t._adjustedScore.call(this,this.opt.score),"img"!==this.opt.starType&&t._adjustStarType.call(this),t._adjustPath.call(this),t._createStars.call(this),this.opt.cancel&&t._createCancel.call(this),this.opt.precision&&t._adjustPrecision.call(this),t._createScore.call(this),t._apply.call(this,this.opt.score),t._setTitle.call(this,this.opt.score),t._target.call(this,this.opt.score),this.opt.readOnly?t._lock.call(this):(this.style.cursor="pointer",t._binds.call(this))})},_adjustCallback:function(){for(var t=["number","readOnly","score","scoreName","target","path"],a=0;a<t.length;a++)"function"==typeof this.opt[t[a]]&&(this.opt[t[a]]=this.opt[t[a]].call(this))},_adjustedScore:function(a){return a?t._between(a,0,this.opt.number):a},_adjustHints:function(){if(this.opt.hints||(this.opt.hints=[]),this.opt.halfShow||this.opt.half)for(var t=this.opt.precision?10:2,a=0;a<this.opt.number;a++){var e=this.opt.hints[a];"[object Array]"!==Object.prototype.toString.call(e)&&(e=[e]),this.opt.hints[a]=[];for(var s=0;t>s;s++){var i=e[s],o=e[e.length-1];void 0===o&&(o=null),this.opt.hints[a][s]=void 0===i?o:i}}},_adjustNumber:function(){this.opt.number=t._between(this.opt.number,1,this.opt.numberMax)},_adjustPath:function(){this.opt.path=this.opt.path||"",this.opt.path&&"/"!==this.opt.path.charAt(this.opt.path.length-1)&&(this.opt.path+="/")},_adjustPrecision:function(){this.opt.half=!0},_adjustStarType:function(){var t=["cancelOff","cancelOn","starHalf","starOff","starOn"];this.opt.path="";for(var a=0;a<t.length;a++)this.opt[t[a]]=this.opt[t[a]].replace(".","-")},_apply:function(a){t._fill.call(this,a),a&&(a>0&&this.score.val(a),t._roundStars.call(this,a))},_between:function(t,a,e){return Math.min(Math.max(parseFloat(t),a),e)},_binds:function(){this.cancel&&(t._bindOverCancel.call(this),t._bindClickCancel.call(this),t._bindOutCancel.call(this)),t._bindOver.call(this),t._bindClick.call(this),t._bindOut.call(this)},_bindClick:function(){var a=this;a.stars.on("click.raty",function(e){var s=!0,i=a.opt.half||a.opt.precision?a.self.data("score"):this.alt||$(this).data("alt");a.opt.click&&(s=a.opt.click.call(a,+i,e)),(s||void 0===s)&&(a.opt.half&&!a.opt.precision&&(i=t._roundHalfScore.call(a,i)),t._apply.call(a,i))})},_bindClickCancel:function(){var t=this;t.cancel.on("click.raty",function(a){t.score.removeAttr("value"),t.opt.click&&t.opt.click.call(t,null,a)})},_bindOut:function(){var a=this;a.self.on("mouseleave.raty",function(e){var s=+a.score.val()||void 0;t._apply.call(a,s),t._target.call(a,s,e),t._resetTitle.call(a),a.opt.mouseout&&a.opt.mouseout.call(a,s,e)})},_bindOutCancel:function(){var a=this;a.cancel.on("mouseleave.raty",function(e){var s=a.opt.cancelOff;if("img"!==a.opt.starType&&(s=a.opt.cancelClass+" "+s),t._setIcon.call(a,this,s),a.opt.mouseout){var i=+a.score.val()||void 0;a.opt.mouseout.call(a,i,e)}})},_bindOver:function(){var a=this,e=a.opt.half?"mousemove.raty":"mouseover.raty";a.stars.on(e,function(e){var s=t._getScoreByPosition.call(a,e,this);t._fill.call(a,s),a.opt.half&&(t._roundStars.call(a,s,e),t._setTitle.call(a,s,e),a.self.data("score",s)),t._target.call(a,s,e),a.opt.mouseover&&a.opt.mouseover.call(a,s,e)})},_bindOverCancel:function(){var a=this;a.cancel.on("mouseover.raty",function(e){var s=a.opt.path+a.opt.starOff,i=a.opt.cancelOn;"img"===a.opt.starType?a.stars.attr("src",s):(i=a.opt.cancelClass+" "+i,a.stars.attr("class",s)),t._setIcon.call(a,this,i),t._target.call(a,null,e),a.opt.mouseover&&a.opt.mouseover.call(a,null)})},_buildScoreField:function(){return $("<input />",{name:this.opt.scoreName,type:"hidden"}).appendTo(this)},_createCancel:function(){var t=this.opt.path+this.opt.cancelOff,a=$("<"+this.opt.starType+" />",{title:this.opt.cancelHint,"class":this.opt.cancelClass});"img"===this.opt.starType?a.attr({src:t,alt:"x"}):a.attr("data-alt","x").addClass(t),"left"===this.opt.cancelPlace?this.self.prepend("&#160;").prepend(a):this.self.append("&#160;").append(a),this.cancel=a},_createScore:function(){var a=$(this.opt.targetScore);this.score=a.length?a:t._buildScoreField.call(this)},_createStars:function(){for(var a=1;a<=this.opt.number;a++){var e=t._nameForIndex.call(this,a),s={alt:a,src:this.opt.path+this.opt[e]};"img"!==this.opt.starType&&(s={"data-alt":a,"class":s.src}),s.title=t._getHint.call(this,a),$("<"+this.opt.starType+" />",s).appendTo(this),this.opt.space&&this.self.append(a<this.opt.number?"&#160;":"")}this.stars=this.self.children(this.opt.starType)},_error:function(t){$(this).text(t),$.error(t)},_fill:function(a){for(var e=0,s=1;s<=this.stars.length;s++){var i,o=this.stars[s-1],r=t._turnOn.call(this,s,a);if(this.opt.iconRange&&this.opt.iconRange.length>e){var n=this.opt.iconRange[e];i=t._getRangeIcon.call(this,n,r),s<=n.range&&t._setIcon.call(this,o,i),s===n.range&&e++}else i=this.opt[r?"starOn":"starOff"],t._setIcon.call(this,o,i)}},_getFirstDecimal:function(t){var a=t.toString().split(".")[1],e=0;return a&&(e=parseInt(a.charAt(0),10),"9999"===a.slice(1,5)&&e++),e},_getRangeIcon:function(t,a){return a?t.on||this.opt.starOn:t.off||this.opt.starOff},_getScoreByPosition:function(a,e){var s=parseInt(e.alt||e.getAttribute("data-alt"),10);if(this.opt.half){var i=t._getWidth.call(this),o=parseFloat((a.pageX-$(e).offset().left)/i);s=s-1+o}return s},_getHint:function(a,e){if(0!==a&&!a)return this.opt.noRatedMsg;var s=t._getFirstDecimal.call(this,a),i=Math.ceil(a),o=this.opt.hints[(i||1)-1],r=o,n=!e||this.move;return this.opt.precision?(n&&(s=0===s?9:s-1),r=o[s]):(this.opt.halfShow||this.opt.half)&&(s=n&&0===s?1:s>5?1:0,r=o[s]),""===r?"":r||a},_getWidth:function(){var a=this.stars[0].width||parseFloat(this.stars.eq(0).css("font-size"));return a||t._error.call(this,"Could not get the icon width!"),a},_lock:function(){var a=t._getHint.call(this,this.score.val());this.style.cursor="",this.title=a,this.score.prop("readonly",!0),this.stars.prop("title",a),this.cancel&&this.cancel.hide(),this.self.data("readonly",!0)},_nameForIndex:function(t){return this.opt.score&&this.opt.score>=t?"starOn":"starOff"},_resetTitle:function(a){for(var e=0;e<this.opt.number;e++)this.stars[e].title=t._getHint.call(this,e+1)},_roundHalfScore:function(a){var e=parseInt(a,10),s=t._getFirstDecimal.call(this,a);return 0!==s&&(s=s>5?1:.5),e+s},_roundStars:function(a,e){var s=(a%1).toFixed(2),i;if(e||this.move?i=s>.5?"starOn":"starHalf":s>this.opt.round.down&&(i="starOn",this.opt.halfShow&&s<this.opt.round.up?i="starHalf":s<this.opt.round.full&&(i="starOff")),i){var o=this.opt[i],r=this.stars[Math.ceil(a)-1];t._setIcon.call(this,r,o)}},_setIcon:function(t,a){t["img"===this.opt.starType?"src":"className"]=this.opt.path+a},_setTarget:function(t,a){a&&(a=this.opt.targetFormat.toString().replace("{score}",a)),t.is(":input")?t.val(a):t.html(a)},_setTitle:function(a,e){if(a){var s=parseInt(Math.ceil(a),10),i=this.stars[s-1];i.title=t._getHint.call(this,a,e)}},_target:function(a,e){if(this.opt.target){var s=$(this.opt.target);s.length||t._error.call(this,"Target selector invalid or missing!");var i=e&&"mouseover"===e.type;if(void 0===a)a=this.opt.targetText;else if(null===a)a=i?this.opt.cancelHint:this.opt.targetText;else{"hint"===this.opt.targetType?a=t._getHint.call(this,a,e):this.opt.precision&&(a=parseFloat(a).toFixed(1));var o=e&&"mousemove"===e.type;i||o||this.opt.targetKeep||(a=this.opt.targetText)}t._setTarget.call(this,s,a)}},_turnOn:function(t,a){return this.opt.single?t===a:a>=t},_unlock:function(){this.style.cursor="pointer",this.removeAttribute("title"),this.score.removeAttr("readonly"),this.self.data("readonly",!1);for(var a=0;a<this.opt.number;a++)this.stars[a].title=t._getHint.call(this,a+1);this.cancel&&this.cancel.css("display","")},cancel:function(a){return this.each(function(){var e=$(this);e.data("readonly")!==!0&&(t[a?"click":"score"].call(e,null),this.score.removeAttr("value"))})},click:function(a){return this.each(function(){$(this).data("readonly")!==!0&&(a=t._adjustedScore.call(this,a),t._apply.call(this,a),this.opt.click&&this.opt.click.call(this,a,$.Event("click")),t._target.call(this,a))})},destroy:function(){return this.each(function(){var t=$(this),a=t.data("raw");a?t.off(".raty").empty().css({cursor:a.style.cursor}).removeData("readonly"):t.data("raw",t.clone()[0])})},getScore:function(){var t=[],a;return this.each(function(){a=this.score.val(),t.push(a?+a:void 0)}),t.length>1?t:t[0]},move:function(a){return this.each(function(){var e=parseInt(a,10),s=t._getFirstDecimal.call(this,a);e>=this.opt.number&&(e=this.opt.number-1,s=10);var i=t._getWidth.call(this),o=i/10,r=$(this.stars[e]),n=r.offset().left+o*s,l=$.Event("mousemove",{pageX:n});this.move=!0,r.trigger(l),this.move=!1})},readOnly:function(a){return this.each(function(){var e=$(this);e.data("readonly")!==a&&(a?(e.off(".raty").children("img").off(".raty"),t._lock.call(this)):(t._binds.call(this),t._unlock.call(this)),e.data("readonly",a))})},reload:function(){return t.set.call(this,{})},score:function(){var a=$(this);return arguments.length?t.setScore.apply(a,arguments):t.getScore.call(a)},set:function(t){return this.each(function(){$(this).raty($.extend({},this.opt,t))})},setScore:function(a){return this.each(function(){$(this).data("readonly")!==!0&&(a=t._adjustedScore.call(this,a),t._apply.call(this,a),t._target.call(this,a))})}};$.fn.raty=function(a){return t[a]?t[a].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof a&&a?void $.error("Method "+a+" does not exist!"):t.init.apply(this,arguments)},$.fn.raty.defaults={cancel:!1,cancelClass:"raty-cancel",cancelHint:"Cancel this rating!",cancelOff:"cancel-off.png",cancelOn:"cancel-on.png",cancelPlace:"left",click:void 0,half:!1,halfShow:!0,hints:["bad","poor","regular","good","gorgeous"],iconRange:void 0,mouseout:void 0,mouseover:void 0,noRatedMsg:"Not rated yet!",number:5,numberMax:20,path:void 0,precision:!1,readOnly:!1,round:{down:.25,full:.6,up:.76},score:void 0,scoreName:"score",single:!1,space:!0,starHalf:"js/raty/images/star-half.png",starOff:"js/raty/images/star-off.png",starOn:"js/raty/images/star-on.png",starType:"img",target:void 0,targetFormat:"{score}",targetKeep:!1,targetScore:void 0,targetText:"",targetType:"hint"}}(jQuery);